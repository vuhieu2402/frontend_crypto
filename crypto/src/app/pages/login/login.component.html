<div class="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center p-4">
    <!-- Background Effects -->
    <div class="absolute inset-0 overflow-hidden">
        <div class="bg-circle top-right"></div>
        <div class="bg-circle bottom-left"></div>
        <div class="bg-circle center-left"></div>
    </div>

    <div class="w-full max-w-md relative z-10 ">
        <!-- Header -->
        <div class="text-center mb-8">
            <div class="flex justify-center mb-4">
                <div class="bg-gradient-to-r from-orange-500 to-yellow-500 p-4 rounded-full shadow-lg">
                    <i class="pi pi-bitcoin text-white text-3xl"></i>
                </div>
            </div>
            <h1 class="text-3xl font-bold text-white mb-2">CryptoVault</h1>
            <p class="text-gray-300">Your Gateway to Digital Assets</p>
            <div class="flex justify-center gap-2 mt-3">
                <span class="p-badge bg-green-500/20 text-green-400 border border-green-500/30 py-1 px-2 rounded-full flex items-center">
                    <i class="pi pi-chart-line text-xs mr-1"></i>
                    Live Trading
                </span>
                <span class="p-badge bg-blue-500/20 text-blue-400 border border-blue-500/30 py-1 px-2 rounded-full flex items-center">
                    <i class="pi pi-shield text-xs mr-1"></i>
                    Secure
                </span>
            </div>
        </div>

        <p-card styleClass="login-card shadow-2xl border-0">
            <ng-template pTemplate="header" style>
                <p-tabView (activeIndexChange)="onTabChange($event)" styleClass="w-full">
                    <p-tabPanel header="Sign In">
                        <div *ngIf="!showTwoFactorForm && !show2FAMethodForm">
                            <div class="text-center mb-4">
                                <h2 class="text-xl text-gray-300 flex items-center justify-center gap-2 mb-1">
                                    <i class="pi pi-user"></i>
                                    Welcome
                                </h2>
                                <p class="text-gray-300">Sign in to access your crypto portfolio</p>
                            </div>

                            <form [formGroup]="loginForm" (ngSubmit)="login()" class="space-y-4">
                                <!-- Email -->
                                <div class="space-y-2">
                                    <label for="login-email" class="block text-gray-200">Username</label>
                                    <div class="relative">
                                        <i class="pi pi-user absolute left-4 top-1/2 -translate-y-1/2 text-gray-200"></i>
                                        <input
                                            id="login-username"
                                            type="text"
                                            pInputText
                                            formControlName="username"
                                            placeholder="Enter your username"
                                            class="w-full border-slate-600"
                                            (input)="clearError('username')"
                                        />
                                    </div>
                                    <div *ngIf="errors['username']" class="text-sm text-red-400 flex items-center gap-1">
                                        <i class="pi pi-exclamation-circle text-xs"></i>
                                        {{errors['username']}}
                                    </div>
                                </div>

                                <!-- Password -->
                                <div class="space-y-2">
                                    <label for="login-password" class="block text-gray-200">Password</label>
                                    <div class="relative">
                                        <i class="pi pi-lock absolute left-4 top-1/2 -translate-y-1/2 text-gray-200"></i>
                                        <input
                                            id="login-password"
                                            [type]="showPassword ? 'text' : 'password'"
                                            pInputText
                                            formControlName="password"
                                            placeholder="Enter your password"
                                            class="w-full pr-10 border-slate-600"
                                            (input)="clearError('password')"
                                        />
                                        <button
                                            type="button"
                                            class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-200 bg-transparent border-none focus:outline-none"
                                            (click)="togglePasswordVisibility()"
                                        >
                                            <i class="pi" [ngClass]="showPassword ? 'pi-eye-slash' : 'pi-eye'"></i>
                                        </button>
                                    </div>
                                    <div *ngIf="errors['password']" class="text-sm text-red-400 flex items-center gap-1">
                                        <i class="pi pi-exclamation-circle text-xs"></i>
                                        {{errors['password']}}
                                    </div>
                                </div>

                                <!-- Remember Me & Forgot Password -->
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-2">
                                        <p-checkbox
                                            id="remember-login"
                                            formControlName="rememberMe"
                                            [binary]="true"
                                            styleClass="border-slate-600"
                                        ></p-checkbox>
                                        <label for="remember-login" class="text-sm text-gray-300">Remember me</label>
                                    </div>
                                    <a href="#" class="text-sm text-purple-400 hover:text-purple-300">Forgot password?</a>
                                </div>

                                <!-- Status Messages -->
                                <div *ngIf="loginStatus === 'success'" class="alert success">
                                    <i class="pi pi-check-circle text-green-400"></i>
                                    <span class="text-green-300">Login successful! Redirecting to dashboard...</span>
                                </div>

                                <div *ngIf="loginStatus === 'error'" class="alert error">
                                    <i class="pi pi-exclamation-circle text-red-400"></i>
                                    <span class="text-red-300">Invalid credentials. Please try again.</span>
                                </div>

                                <!-- Submit Button -->
                                <button
                                    pButton
                                    type="submit"
                                    class="w-full bg-gradient from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-semibold py-2.5"
                                    [disabled]="isLoading"
                                >
                                    <ng-container *ngIf="isLoading; else notLoading">
                                        <div class="flex items-center gap-2">
                                            <div class="h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"></div>
                                            Signing In...
                                        </div>
                                    </ng-container>
                                    <ng-template #notLoading>
                                        <div class="flex items-center">
                                            <i class="pi pi-wallet mr-2"></i>
                                            Sign In
                                        </div>
                                    </ng-template>
                                </button>
                            </form>
                        </div>
                        
                        <div *ngIf="show2FAMethodForm">
                            <div class="text-center mb-4">
                                <h2 class="text-xl text-gray-300 flex items-center justify-center gap-2 mb-1">
                                    <i class="pi pi-shield-check"></i>
                                    Select Verification Method
                                </h2>
                                <p class="text-gray-300">Please choose how you'd like to receive your verification code.</p>
                            </div>
                        
                            <div class="space-y-3">
                                <button pButton type="button" (click)="select2FAMethod('email')" class="w-full p-button-outlined" [disabled]="isLoading">
                                    <i class="pi pi-envelope mr-2"></i>
                                    Send to Email
                                </button>
                                <button pButton type="button" (click)="select2FAMethod('sms')" class="w-full p-button-outlined" [disabled]="isLoading">
                                    <i class="pi pi-mobile mr-2"></i>
                                    Send to SMS
                                </button>
                            </div>
                        </div>

                        <div *ngIf="showTwoFactorForm">
                            <div class="text-center mb-4">
                                <h2 class="text-xl text-gray-300 flex items-center justify-center gap-2 mb-1">
                                    <i class="pi pi-shield-check"></i>
                                    Two-Factor Authentication
                                </h2>
                                <p class="text-gray-300">A verification code has been sent to your primary method. Please enter it below.</p>
                            </div>

                            <form [formGroup]="twoFactorForm" (ngSubmit)="verify2fa()" class="space-y-4">
                                <!-- 2FA Code -->
                                <div class="space-y-2">
                                    <label for="2fa-code" class="block text-gray-200">Verification Code</label>
                                    <div class="relative">
                                        <i class="pi pi-key absolute left-4 top-1/2 -translate-y-1/2 text-gray-200"></i>
                                        <input
                                            id="2fa-code"
                                            type="text"
                                            pInputText
                                            formControlName="code"
                                            placeholder="Enter 6-digit code"
                                            class="w-full border-slate-600 text-center tracking-widest"
                                        />
                                    </div>
                                </div>

                                <!-- Submit Button -->
                                <button
                                    pButton
                                    type="submit"
                                    class="w-full bg-gradient from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 text-white font-semibold py-2.5"
                                    [disabled]="isLoading"
                                >
                                    <ng-container *ngIf="isLoading; else notLoadingVerify">
                                        <div class="flex items-center justify-center gap-2">
                                            <div class="h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"></div>
                                            Verifying...
                                        </div>
                                    </ng-container>
                                    <ng-template #notLoadingVerify>
                                        <div class="flex items-center justify-center">
                                            <i class="pi pi-check-circle mr-2"></i>
                                            Verify
                                        </div>
                                    </ng-template>
                                </button>
                            </form>

                            <div class="text-center mt-4">
                                <p class="text-sm text-gray-400 mb-2">Didn't receive the code?</p>
                                <a href="javascript:void(0)" (click)="requestCode('email')" class="text-sm text-purple-400 hover:text-purple-300">
                                    Resend to Email
                                </a>
                                <span class="text-gray-500 mx-2">|</span>
                                <a href="javascript:void(0)" (click)="requestCode('sms')" class="text-sm text-purple-400 hover:text-purple-300">
                                    Send to SMS
                                </a>
                            </div>
                        </div>
                    </p-tabPanel>
                    
                    <p-tabPanel header="Sign Up">
                        <div class="text-center mb-4">
                            <h2 class="text-xl text-white flex items-center justify-center gap-2 mb-1">
                                <i class="pi pi-user"></i>
                                Create Account
                            </h2>
                            <p class="text-gray-300">Join thousands of crypto traders</p>
                        </div>

                        <form [formGroup]="registerForm" (ngSubmit)="register()" class="space-y-4">
                            <!-- Email -->
                            <div class="space-y-2">
                                <label for="register-email" class="block text-gray-200">Email Address</label>
                                <div class="relative">
                                    <i class="pi pi-envelope absolute left-4 top-1/2 -translate-y-1/2 text-gray-200"></i>
                                    <input 
                                        id="register-email" 
                                        type="email" 
                                        pInputText
                                        formControlName="email"
                                        placeholder="Enter your email" 
                                        class="w-full border-slate-600"
                                        (input)="clearError('email')"
                                    />
                                </div>
                                <div *ngIf="errors['email']" class="text-sm text-red-400 flex items-center gap-1">
                                    <i class="pi pi-exclamation-circle text-xs"></i>
                                    {{errors['email']}}
                                </div>
                            </div>

                            <!-- Password -->
                            <div class="space-y-2">
                                <label for="register-password" class="block text-gray-200">Password</label>
                                <div class="relative">
                                    <i class="pi pi-lock absolute left-4 top-1/2 -translate-y-1/2 text-gray-200"></i>
                                    <input 
                                        id="register-password" 
                                        [type]="showPassword ? 'text' : 'password'"
                                        pInputText
                                        formControlName="password"
                                        placeholder="Create a strong password" 
                                        class="w-full pr-10 border-slate-600"
                                        (input)="clearError('password')"
                                    />
                                    <button 
                                        type="button" 
                                        class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-200 bg-transparent border-none focus:outline-none"
                                        (click)="togglePasswordVisibility()"
                                    >
                                        <i class="pi" [ngClass]="showPassword ? 'pi-eye-slash' : 'pi-eye'"></i>
                                    </button>
                                </div>
                                <div *ngIf="errors['password']" class="text-sm text-red-400 flex items-center gap-1">
                                    <i class="pi pi-exclamation-circle text-xs"></i>
                                    {{errors['password']}}
                                </div>
                            </div>

                            <!-- Confirm Password -->
                            <div class="space-y-2">
                                <label for="confirm-password" class="block text-gray-200">Confirm Password</label>
                                <div class="relative">
                                    <i class="pi pi-lock absolute left-4 top-1/2 -translate-y-1/2 text-gray-200"></i>
                                    <input 
                                        id="confirm-password" 
                                        type="password"
                                        pInputText
                                        formControlName="confirmPassword"
                                        placeholder="Confirm your password" 
                                        class="w-full border-slate-600"
                                        (input)="clearError('confirmPassword')"
                                    />
                                </div>
                                <div *ngIf="errors['confirmPassword']" class="text-sm text-red-400 flex items-center gap-1">
                                    <i class="pi pi-exclamation-circle text-xs"></i>
                                    {{errors['confirmPassword']}}
                                </div>
                            </div>

                            <!-- Referral Code -->
                            <div class="space-y-2">
                                <label for="referral" class="block text-gray-200">Referral Code (Optional)</label>
                                <input 
                                    id="referral" 
                                    type="text"
                                    pInputText
                                    formControlName="referralCode"
                                    placeholder="Enter referral code" 
                                    class="w-full border-slate-600"
                                />
                            </div>

                            <!-- Terms -->
                            <div class="flex items-start space-x-2">
                                <p-checkbox 
                                    id="terms"
                                    formControlName="acceptTerms"
                                    [binary]="true"
                                    styleClass="border-slate-600 mt-1"
                                    (onChange)="clearError('acceptTerms')"
                                ></p-checkbox>
                                <label for="terms" class="text-sm text-gray-300 leading-relaxed">
                                    I agree to the 
                                    <a href="#" class="text-purple-400 hover:text-purple-300">Terms of Service</a> 
                                    and 
                                    <a href="#" class="text-purple-400 hover:text-purple-300">Privacy Policy</a>
                                </label>
                            </div>
                            <div *ngIf="errors['acceptTerms']" class="text-sm text-red-400 flex items-center gap-1">
                                <i class="pi pi-exclamation-circle text-xs"></i>
                                {{errors['acceptTerms']}}
                            </div>

                            <!-- Status Messages -->
                            <div *ngIf="loginStatus === 'success'" class="alert success">
                                <i class="pi pi-check-circle text-green-400"></i>
                                <span class="text-green-300">Account created successfully! Please verify your email.</span>
                            </div>

                            <div *ngIf="loginStatus === 'error'" class="alert error">
                                <i class="pi pi-exclamation-circle text-red-400"></i>
                                <span class="text-red-300">Registration failed. Please try again.</span>
                            </div>

                            <!-- Submit Button -->
                            <button 
                                pButton 
                                type="submit" 
                                class="w-full bg-gradient-to-r from-green-600 to-blue-600 hover:from-green-700 hover:to-blue-700 text-white font-semibold py-2.5"
                                [disabled]="isLoading"
                            >
                                <ng-container *ngIf="isLoading; else notLoadingRegister">
                                    <div class="flex items-center gap-2">
                                        <div class="h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"></div>
                                        Creating Account...
                                    </div>
                                </ng-container>
                                <ng-template #notLoadingRegister>
                                    <div class="flex items-center">
                                        <i class="pi pi-wallet mr-2"></i>
                                        Create Account
                                    </div>
                                </ng-template>
                            </button>
                        </form>
                    </p-tabPanel>
                </p-tabView>
            </ng-template>

            <p-divider styleClass="mb-6 bg-slate-600"></p-divider>

            <!-- Alternative Login Methods -->
            <div class="space-y-3">
                <p class="text-center text-sm text-gray-400">Or continue with</p>
                <div class="grid grid-cols-2 gap-3">
                    <button 
                        pButton 
                        type="button" 
                        class="p-button-outlined bg-slate-700/50 border-slate-600 text-gray-300 hover:bg-slate-600"
                    >
                        <i class="pi pi-mobile mr-2"></i>
                        2FA App
                    </button>
                    <button 
                        pButton 
                        type="button" 
                        class="p-button-outlined bg-slate-700/50 border-slate-600 text-gray-300 hover:bg-slate-600"
                    >
                        <i class="pi pi-qrcode mr-2"></i>
                        QR Code
                    </button>
                </div>
            </div>
        </p-card>

        <!-- Footer -->
        <div class="text-center mt-6 text-xs text-gray-400">
            <p>Â© 2024 CryptoVault. All rights reserved.</p>
            <p class="mt-1">Secured by blockchain technology</p>
        </div>
    </div>
</div>

<!-- 2FA Dialog -->
<p-dialog header="Two-Factor Authentication" [(visible)]="showTwoFactorForm" [modal]="true" [style]="{width: '25rem'}" styleClass="bg-slate-800 text-white">
    <div class="text-center mb-4">
        <i class="pi pi-shield-check text-5xl text-green-400"></i>
        <h2 class="text-xl text-gray-300 mt-2">Enter Verification Code</h2>
        <p class="text-gray-400">A code has been sent to your authenticator app.</p>
    </div>

    <form [formGroup]="twoFactorForm" (ngSubmit)="verify2fa()" class="space-y-4">
        <div class="space-y-2">
            <label for="dialog-2fa-code" class="block text-gray-200">Verification Code</label>
            <div class="relative">
                <i class="pi pi-key absolute left-4 top-1/2 -translate-y-1/2 text-gray-200"></i>
                <input 
                    id="dialog-2fa-code" 
                    type="text" 
                    pInputText
                    formControlName="code"
                    placeholder="Enter 6-digit code" 
                    class="w-full border-slate-600 text-center tracking-widest"
                    autocomplete="off"
                />
            </div>
        </div>

        <button 
            pButton 
            type="submit" 
            class="w-full bg-gradient from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 text-white font-semibold py-2.5"
            [disabled]="isLoading"
        >
            <ng-container *ngIf="isLoading; else notLoadingVerifyDialog">
                <div class="flex items-center justify-center gap-2">
                    <div class="h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"></div>
                    Verifying...
                </div>
            </ng-container>
            <ng-template #notLoadingVerifyDialog>
                <div class="flex items-center justify-center">
                    <i class="pi pi-check-circle mr-2"></i>
                    Verify
                </div>
            </ng-template>
        </button>
    </form>
</p-dialog>
